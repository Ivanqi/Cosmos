# CPU加载内存段的过程
在保护模式下，段描述符是内存段的身份证

CPU在引用一个段时，都要先查看段描述符。很多时候，段描述符存在于描述符表中(GDT或LDT)，但与对应的段并不在内存中

也就是说，CPU允许在描述符表中已注册的段不在内存中存在，这就是它提供给软件使用策略，我们利用它实现段式内存管理

如果该描述符中的P位为1，表示该段在内存中存在。访问过该段后，CPU将段描述符中的A位置1，表示进来刚访问过该段

如果P位为0，说明内存中并不存在该段
- 这时候CPU将会抛出NP(段不存在)异常，转而去执行中断描述符表中NP异常对应的中断处理程序，此中断中断处理程序是操作系统负责提供的
- 该程序的工作是将相应的段从外存(比如硬盘)中载入内存，并将段描述符的P位置1
- 中断处理函数结束后返回，CPU重复执行这个检查，继续查看该段描述符的P位，此时已经为1了，在检查通过后，将段描述符的A位置1

# 内存段是何时移出到外存上
段描述符的A位由CPU置1，但清0工作可是由操作系统来完成的。

A位干嘛用的？如果仅仅用来表示该段被访问过，这也意义不大？！

其实这正是软件和硬件相互配合的体现，操作系统每发现该位为1后就将该位清0，这样一来，在一个周期内统计该位为1的次数就知道该段的使频率，从而可以找到使用频率最低的段

当物理内存不足时，可以将使用频率最低的段换出到硬盘，以腾出内存空间给新的进程。

当段被换出到硬盘后，操作系统将该段描述符的P位置0，当下次这个进程上CPU运行后，如果访问了这个段，这个程序流就回到了刚开始CPU检查出P位为、紧接着抛出异常、执行操作系统中断处理程序、换入内存段的循环

另外，内存中的数据是二进制的，段被换出到硬盘上也以二进制形式存储，数据内容都是一样的，只是存储介质不同而已

不要因为陌生而觉得段的换入换出深不可测，这无非是一段二进制数据在内存和外存之间拷贝来拷贝去而已，其过程就像将一个txt文件读到内存中修改后再保存到硬盘一样